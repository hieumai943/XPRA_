!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n||e)},f,f.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){exports.FLACDemuxer=require("./src/demuxer"),exports.FLACDecoder=require("./src/decoder"),require("./src/ogg")},{"./src/decoder":2,"./src/demuxer":3,"./src/ogg":4}],2:[function(require,module,exports){(function(global){var AV="undefined"!=typeof window?window.AV:void 0!==global?global.AV:null,FLACDecoder=AV.Decoder.extend(function(){function multiply_add(total,a,b){var r=a*b,n=r<0;n&&(r=-r);var r_low=r%TWO_PWR_32_DBL|0,r_high=r/TWO_PWR_32_DBL|0;n&&(r_low=1+~r_low,r_high=~r_high);var a48=total[1]>>>16,a32=65535&total[1],a16=total[0]>>>16,a00=65535&total[0],b48=r_high>>>16,b32=65535&r_high,b16=r_low>>>16,b00=65535&r_low,c48=0,c32=0,c16=0,c00=0;c00+=a00+b00,c16+=c00>>>16,c00&=65535,c16+=a16+b16,c32+=c16>>>16,c16&=65535,c32+=a32+b32,c48+=c32>>>16,c32&=65535,c48+=a48+b48,c48&=65535,total[0]=c16<<16|c00,total[1]=c48<<16|c32}function clz(input){for(var output=0,curbyte=0;;){if(curbyte=input>>>24)break;if(output+=8,255&(curbyte=input>>>16))break;if(output+=8,255&(curbyte=input>>>8))break;if(output+=8,255&(curbyte=input))break;return output+=8}return 240&curbyte?curbyte>>>=4:output+=4,8&curbyte?output:4&curbyte?output+1:2&curbyte?output+2:1&curbyte?output+3:output+4}AV.Decoder.register("flac",this),this.prototype.setCookie=function(cookie){this.cookie=cookie,this.decoded=[];for(var i=0;i<this.format.channelsPerFrame;i++)this.decoded[i]=new Int32Array(cookie.maxBlockSize);this.lpc_total=new Int32Array(2)};var BLOCK_SIZES=new Int16Array([0,192,576,1152,2304,4608,0,0,256,512,1024,2048,4096,8192,16384,32768]),SAMPLE_RATES=new Int32Array([0,88200,176400,192e3,8e3,16e3,22050,24e3,32e3,44100,48e3,96e3,0,0,0,0]),SAMPLE_SIZES=new Int8Array([0,8,12,0,16,20,24,0]);this.prototype.readChunk=function(){var stream=this.bitstream;if(stream.available(32)){if(32764!=(32767&stream.read(15)))throw new Error("Invalid sync code");var bsCode=(stream.read(1),stream.read(4)),srCode=stream.read(4),chMode=stream.read(4),bpsCode=stream.read(3);stream.advance(1),this.chMode=chMode;var channels;if(chMode<8)channels=chMode+1,this.chMode=0;else{if(!(chMode<=10))throw new Error("Invalid channel mode");channels=2}if(channels!==this.format.channelsPerFrame)throw new Error("Switching channel layout mid-stream not supported.");if(3===bpsCode||7===bpsCode)throw new Error("Invalid sample size code");if(this.bps=SAMPLE_SIZES[bpsCode],this.bps!==this.format.bitsPerChannel)throw new Error("Switching bits per sample mid-stream not supported.");for(var ones=0;1===stream.read(1);)ones++;for(var frame_or_sample_num=stream.read(7-ones);ones>1;ones--)stream.advance(2),frame_or_sample_num=frame_or_sample_num<<6|stream.read(6);if(0===bsCode)throw new Error("Reserved blocksize code");this.blockSize=6===bsCode?stream.read(8)+1:7===bsCode?stream.read(16)+1:BLOCK_SIZES[bsCode];if(srCode<12)SAMPLE_RATES[srCode];else if(12===srCode)1e3*stream.read(8);else if(13===srCode)stream.read(16);else{if(14!==srCode)throw new Error("Invalid sample rate code");10*stream.read(16)}stream.advance(8);for(var i=0;i<channels;i++)this.decodeSubframe(i);stream.align(),stream.advance(16);var is32=this.bps>16,output=new ArrayBuffer(this.blockSize*channels*(is32?4:2)),buf=is32?new Int32Array(output):new Int16Array(output),blockSize=this.blockSize,decoded=this.decoded,j=0;switch(this.chMode){case 0:for(var k=0;k<blockSize;k++)for(var i=0;i<channels;i++)buf[j++]=decoded[i][k];break;case 8:for(var i=0;i<blockSize;i++){var left=decoded[0][i],right=decoded[1][i];buf[j++]=left,buf[j++]=left-right}break;case 9:for(var i=0;i<blockSize;i++){var left=decoded[0][i],right=decoded[1][i];buf[j++]=left+right,buf[j++]=right}break;case 10:for(var i=0;i<blockSize;i++){var left=decoded[0][i],right=decoded[1][i];left-=right>>1,buf[j++]=left+right,buf[j++]=left}}return buf}},this.prototype.decodeSubframe=function(channel){var wasted=0,stream=this.bitstream,blockSize=this.blockSize,decoded=this.decoded;if(this.curr_bps=this.bps,0===channel?9===this.chMode&&this.curr_bps++:8!==this.chMode&&10!==this.chMode||this.curr_bps++,stream.read(1))throw new Error("Invalid subframe padding");var type=stream.read(6);if(stream.read(1)){for(wasted=1;!stream.read(1);)wasted++;this.curr_bps-=wasted}if(this.curr_bps>32)throw new Error("decorrelated bit depth > 32 ("+this.curr_bps+")");if(0===type)for(var tmp=stream.read(this.curr_bps,!0),i=0;i<blockSize;i++)decoded[channel][i]=tmp;else if(1===type)for(var bps=this.curr_bps,i=0;i<blockSize;i++)decoded[channel][i]=stream.read(bps,!0);else if(type>=8&&type<=12)this.decode_subframe_fixed(channel,-9&type);else{if(!(type>=32))throw new Error("Invalid coding type");this.decode_subframe_lpc(channel,1+(-33&type))}if(wasted)for(var i=0;i<blockSize;i++)decoded[channel][i]<<=wasted},this.prototype.decode_subframe_fixed=function(channel,predictor_order){for(var decoded=this.decoded[channel],stream=this.bitstream,bps=this.curr_bps,i=0;i<predictor_order;i++)decoded[i]=stream.read(bps,!0);this.decode_residuals(channel,predictor_order);var a=0,b=0,c=0,d=0;switch(predictor_order>0&&(a=decoded[predictor_order-1]),predictor_order>1&&(b=a-decoded[predictor_order-2]),predictor_order>2&&(c=b-decoded[predictor_order-2]+decoded[predictor_order-3]),predictor_order>3&&(d=c-decoded[predictor_order-2]+2*decoded[predictor_order-3]-decoded[predictor_order-4]),predictor_order){case 0:break;case 1:case 2:case 3:case 4:for(var abcd=new Int32Array([a,b,c,d]),blockSize=this.blockSize,i=predictor_order;i<blockSize;i++){abcd[predictor_order-1]+=decoded[i];for(var j=predictor_order-2;j>=0;j--)abcd[j]+=abcd[j+1];decoded[i]=abcd[0]}break;default:throw new Error("Invalid Predictor Order "+predictor_order)}},this.prototype.decode_subframe_lpc=function(channel,predictor_order){for(var stream=this.bitstream,decoded=this.decoded[channel],bps=this.curr_bps,blockSize=this.blockSize,i=0;i<predictor_order;i++)decoded[i]=stream.read(bps,!0);var coeff_prec=stream.read(4)+1;if(16===coeff_prec)throw new Error("Invalid coefficient precision");var qlevel=stream.read(5,!0);if(qlevel<0)throw new Error("Negative qlevel, maybe buggy stream");for(var coeffs=new Int32Array(32),i=0;i<predictor_order;i++)coeffs[i]=stream.read(coeff_prec,!0);if(this.decode_residuals(channel,predictor_order),this.bps<=16){for(var i=predictor_order;i<blockSize-1;i+=2){for(var d=decoded[i-predictor_order],s0=0,s1=0,c=0,j=predictor_order-1;j>0;j--)c=coeffs[j],s0+=c*d,d=decoded[i-j],s1+=c*d;c=coeffs[0],s0+=c*d,d=decoded[i]+=s0>>qlevel,s1+=c*d,decoded[i+1]+=s1>>qlevel}if(i<blockSize){for(var sum=0,j=0;j<predictor_order;j++)sum+=coeffs[j]*decoded[i-j-1];decoded[i]+=sum>>qlevel}}else for(var total=this.lpc_total,i=predictor_order;i<blockSize;i++){for(total[0]=0,total[1]=0,j=0;j<predictor_order;j++)multiply_add(total,coeffs[j],decoded[i-j-1]);decoded[i]+=total[0]>>>qlevel|total[1]<<32-qlevel}};var TWO_PWR_32_DBL=Math.pow(2,32);this.prototype.decode_residuals=function(channel,predictor_order){var stream=this.bitstream,method_type=stream.read(2);if(method_type>1)throw new Error("Illegal residual coding method "+method_type);var rice_order=stream.read(4),samples=this.blockSize>>>rice_order;if(predictor_order>samples)throw new Error("Invalid predictor order "+predictor_order+" > "+samples);for(var decoded=this.decoded[channel],sample=predictor_order,i=predictor_order,partition=0;partition<1<<rice_order;partition++){var tmp=stream.read(0===method_type?4:5);if(tmp===(0===method_type?15:31))for(tmp=stream.read(5);i<samples;i++)decoded[sample++]=stream.read(tmp,!0);else for(;i<samples;i++)decoded[sample++]=this.golomb(tmp,32767,0);i=0}};this.prototype.golomb=function(k,limit,esc_len){var data=this.bitstream,offset=data.bitPosition,buf=data.peek(32-offset)<<offset,v=0,log=31-clz(1|buf);if(log-k>=7&&32-log<limit)buf>>>=log-k,buf+=30-log<<k,data.advance(32+k-log),v=buf;else{for(var i=0;0===data.read(1);i++)buf=data.peek(32-offset)<<offset;i<limit-1?(buf=k?data.read(k):0,v=buf+(i<<k)):i===limit-1?(buf=data.read(esc_len),v=buf+1):v=-1}return v>>1^-(1&v)}});module.exports=FLACDecoder}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(require,module,exports){(function(global){var AV="undefined"!=typeof window?window.AV:void 0!==global?global.AV:null,FLACDemuxer=AV.Demuxer.extend(function(){AV.Demuxer.register(this),this.probe=function(buffer){return"fLaC"===buffer.peekString(0,4)};this.prototype.readChunk=function(){var stream=this.stream;if(!this.readHeader&&stream.available(4)){if("fLaC"!==stream.readString(4))return this.emit("error","Invalid FLAC file.");this.readHeader=!0}for(;stream.available(1)&&!this.last;){if(!this.readBlockHeaders){var tmp=stream.readUInt8();this.last=128==(128&tmp),this.type=127&tmp,this.size=stream.readUInt24()}if(!this.foundStreamInfo&&0!==this.type)return this.emit("error","STREAMINFO must be the first block");if(!stream.available(this.size))return;switch(this.type){case 0:if(this.foundStreamInfo)return this.emit("error","STREAMINFO can only occur once.");if(34!==this.size)return this.emit("error","STREAMINFO size is wrong.");this.foundStreamInfo=!0;var bitstream=new AV.Bitstream(stream),cookie={minBlockSize:bitstream.read(16),maxBlockSize:bitstream.read(16),minFrameSize:bitstream.read(24),maxFrameSize:bitstream.read(24)};this.format={formatID:"flac",sampleRate:bitstream.read(20),channelsPerFrame:bitstream.read(3)+1,bitsPerChannel:bitstream.read(5)+1},this.emit("format",this.format),this.emit("cookie",cookie);var sampleCount=bitstream.read(36);this.emit("duration",sampleCount/this.format.sampleRate*1e3|0),stream.advance(16),this.readBlockHeaders=!1;break;case 3:for(var s=0;s<this.size/18;s++)if(4294967295==stream.peekUInt32(0)&&4294967295==stream.peekUInt32(1))stream.advance(18);else{stream.readUInt32()>0&&this.emit("error","Seek points with sample number >UInt32 not supported");var samplenum=stream.readUInt32();stream.readUInt32()>0&&this.emit("error","Seek points with stream offset >UInt32 not supported");var offset=stream.readUInt32();stream.advance(2),this.addSeekPoint(offset,samplenum)}break;case 4:this.metadata||(this.metadata={});var len=stream.readUInt32(!0);this.metadata.vendor=stream.readString(len);for(var length=stream.readUInt32(!0),i=0;i<length;i++){len=stream.readUInt32(!0);var str=stream.readString(len,"utf8"),idx=str.indexOf("=");this.metadata[str.slice(0,idx).toLowerCase()]=str.slice(idx+1)}break;case 6:if(3!==stream.readUInt32())stream.advance(this.size-4);else{var mimeLen=stream.readUInt32(),descLen=(stream.readString(mimeLen),stream.readUInt32()),length=(stream.readString(descLen),stream.readUInt32(),stream.readUInt32(),stream.readUInt32(),stream.readUInt32(),stream.readUInt32()),picture=stream.readBuffer(length);this.metadata||(this.metadata={}),this.metadata.coverArt=picture}break;default:stream.advance(this.size),this.readBlockHeaders=!1}this.last&&this.metadata&&this.emit("metadata",this.metadata)}for(;stream.available(1)&&this.last;){var buffer=stream.readSingleBuffer(stream.remainingBytes());this.emit("data",buffer)}}});module.exports=FLACDemuxer}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],4:[function(require,module,exports){(function(global){var AV="undefined"!=typeof window?window.AV:void 0!==global?global.AV:null;try{var OggDemuxer="undefined"!=typeof window?window.AV.OggDemuxer:void 0!==global?global.AV.OggDemuxer:null}catch(e){}OggDemuxer&&OggDemuxer.plugins.push({magic:"FLAC",init:function(){this.list=new AV.BufferList,this.stream=new AV.Stream(this.list)},readHeaders:function(packet){var stream=this.stream;if(this.list.append(new AV.Buffer(packet)),stream.advance(5),1!=stream.readUInt8())throw new Error("Unsupported FLAC version");if(stream.advance(3),"fLaC"!=stream.peekString(0,4))throw new Error("Not flac");if(this.flac=AV.Demuxer.find(stream.peekSingleBuffer(0,stream.remainingBytes())),!this.flac)throw new Error("Flac demuxer not found");return this.flac.prototype.readChunk.call(this),!0},readPacket:function(packet){this.list.append(new AV.Buffer(packet)),this.flac.prototype.readChunk.call(this)}})}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1]);