$(function(){window.notification_timers={},window.doNotification=function(type,nid,title,message,timeout,icon,actions,hints,onAction,onClose){console.debug("doNotification",type,nid,title,message,timeout,icon,actions,hints,onAction,onClose);var nID="notification"+nid,a=$('<div id="'+nID+'" class="alert '+type+'"><img class="notification_icon" id="notification_icon'+nID+'"><span class="title">'+title+'</span><span class="message">'+message+'</span><div class="dismiss">&#215;</div></div>'),notifications_elements=$(".notifications");if(notifications_elements.prepend(a),actions){var notification_buttons=$('<div class="notification_buttons"></div>');a.append(notification_buttons);for(var i=0;i<actions.length;i+=2){var action_id=actions[i],action_label=actions[i+1],notification_button=window._notification_button(nid,action_id,action_label,onAction,onClose);notification_buttons.append(notification_button)}}if(notifications_elements.prepend(a),icon){var encoding=icon[0],img_data=icon[3];if("png"==encoding){var src="data:image/"+encoding+";base64,"+window.btoa(img_data);$("#notification_icon"+nID).attr("src",src)}}return a.on("click",".dismiss",function(){window.cancelNotificationTimer(nid),a.removeClass("visible").addClass("hidden"),a.on("transitionend webkitTransitionEnd",$.debounce(250,function(){a.trigger("dismissed"),a.remove(),onClose&&onClose(nid,3,"user clicked dismiss")}))}),setTimeout(function(){a.addClass("visible")},1),timeout&&(a.data("timeLeft",timeout),window.notification_timers[nid]=setInterval(function(){var tleft=a.data("timeLeft")-1;0===a.data("timeLeft")?(a.find(".dismiss").trigger("click"),onClose&&onClose(nid,1,"timeout")):(a.find("sec").text(tleft),a.data("timeLeft",tleft))},1e3)),a},window._notification_button=function(nid,action_id,action_label,onAction,onClose){var notification_button=$('<div class="notification_button" id=notification"'+action_id+'">'+action_label+"</div>");return notification_button.on("click",function(){window.closeNotification(nid),onAction&&onAction(nid,action_id),onClose&&onClose(nid,3,"user clicked action")}),notification_button},window.cancelNotificationTimer=function(nid){var timer=window.notification_timers[nid];timer&&(window.clearInterval(timer),delete window.notification_timers[nid])},window.cancelNotificationTimers=function(){for(var nid in window.notification_timers)window.cancelNotificationTimer(nid)},window.closeNotification=function(nid){window.cancelNotificationTimer(nid);var nID="notification"+nid;$(".notifications").find("#"+nID).find(".dismiss").trigger("click")},window.clearNotifications=function(){window.cancelNotificationTimers(),$(".notifications").find(".dismiss").trigger("click")},window.removeNotifications=function(){window.cancelNotificationTimers(),$(".notifications").empty()}});